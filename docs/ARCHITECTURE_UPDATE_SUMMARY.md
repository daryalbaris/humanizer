# Architecture & PRD Update Summary

**Date:** 2025-10-30
**Updated By:** Winston (Architect Agent)
**Reason:** Correct Claude Code agent execution model

---

## Changes Overview

Both PRD v1.1 and Architecture v1.0 have been updated to reflect the **correct understanding** of how Claude Code agent execution works.

### ❌ REMOVED: Incorrect Statements

**Old (Incorrect) Description:**
- "Built-in model access via terminal"
- "No external API calls"
- "Claude orchestrator calls Claude API"
- References to Opus/Sonnet models as separate services

**Why These Were Wrong:**
- Implied Claude Code had some special "built-in terminal access" that bypassed APIs
- Suggested orchestrator was a Python program calling Anthropic SDK
- Created confusion about execution model

### ✅ ADDED: Correct Description

**New (Correct) Description:**
- **Claude agent performs AI tasks via direct inference**
- User's Claude Code subscription provides all AI capabilities
- No additional API integrations or credentials required
- Python tools perform computational work only (no AI inference)

---

## Detailed Changes by Document

### PRD v1.1 Updates

**Section: Technical Assumptions → Assumption 1**
- Updated architectural diagram to show "Claude Agent" with "Direct AI Inference"
- Clarified: "Claude agent performs ALL AI tasks directly using its own inference capabilities"
- Updated key points to emphasize no separate API calls

**Section: Technical Assumptions → Assumption 3**
- Changed from "API Rate Limits & Costs" to "Claude Code Subscription & Token Usage"
- Removed API cost breakdown ($2-4 per paper)
- Added note: "Token usage tracked but covered by user's existing subscription"

**Section: Technical Assumptions → Assumption 4**
- Changed "Claude Sonnet" to "Claude agent's detection analysis"
- Updated all references to detection proxy

**Section: Non-Functional Requirements → NFR-1**
- Removed API cost breakdown
- Changed to token usage tracking
- Updated: "Included in user's Claude Code subscription (no separate charges)"

**Section: Non-Functional Requirements → NFR-2**
- Updated success rate from "95-98%" to "90-95%" (matching revised PRD findings)
- Changed "Claude Sonnet" to "Claude agent analysis"
- Updated fault tolerance language (removed API failures, added processing failures)

---

### Architecture v1.0 Updates

**Section 1.3: System Overview**
- Added: "Claude agent (YOU) - performs all AI tasks via direct inference"
- Added: "No additional API integrations required beyond user's Claude Code subscription"
- Clarified workers "perform computational tasks only"

**Section 2.2: High Level Architecture**
- Updated Mermaid diagram:
  - "Claude Agent Orchestrator" with "Direct AI Inference"
  - User box shows "Claude Code Subscription"
  - Step 2: "Generate paraphrase using direct inference"
  - Step 6: "Analyze for AI detection using direct reasoning"
- Updated key architecture points (4 bullets) to clarify execution model

**Section 5.1: Component Overview**
- Updated table description for Claude CLI Orchestrator

**Section 5.2: Component Interaction Diagram**
- Updated Mermaid diagram (same changes as Section 2.2)

**Section 5.3.1: Claude Agent Orchestrator**
- **Major rewrite** with new section: "AI Inference Tasks (performed directly)"
  - Paraphrasing: Generate using language generation capabilities
  - AI Detection Analysis: Analyze and estimate likelihood
  - Translation Chain: Perform multi-hop translation
- Updated communication pattern description
- Added clarification in execution example

**Section 5.3.3: paraphraser_processor.py**
- Updated: "Post-process paraphrased text generated by Claude agent's direct inference"
- Clarified: "does NOT perform paraphrasing"

**Section 5.3.6: detector_processor.py**
- Updated: "Process AI detection results generated by Claude agent's direct analysis"
- Clarified: "does NOT perform AI detection"

**Section 6: External APIs**
- **Section 6.1 (Summary)**: Complete rewrite
  - "No additional API integrations or credentials required"
  - Clarified AI capabilities provided by Claude agent
  - User requirements: Active Claude Code subscription

- **Section 6.2 (Why No Additional APIs?)**: Updated table
  - Anthropic Claude: ✅ Included (not ❌ Not Used)
  - Added explanation for each service

**Section 7.2: Main Humanization Workflow**
- Updated sequence diagram comments:
  - STEP 2: "Paraphrasing (Direct Inference)"
  - STEP 6: "AI Detection (Direct Reasoning)"

---

## Key Concepts Clarified

### 1. What IS the Orchestrator?

**Correct Understanding:**
- The orchestrator IS Claude (me) running as an agent in Claude Code
- I perform AI tasks (paraphrasing, detection, translation) using my own inference
- I execute Python tools via Bash for computational work
- I coordinate workflow, make decisions, manage human interaction

**NOT:**
- A separate Python application that imports `anthropic` SDK
- A service that "calls Claude API"
- Something with "built-in terminal access" to models

### 2. What ARE the Python Tools?

**Correct Understanding:**
- Computational workers (NLP analysis, scoring, validation, state management)
- Receive JSON via stdin, return JSON via stdout
- No AI inference capabilities
- No API calls to any service

**NOT:**
- AI-powered components
- Services that call Claude API
- Components that perform paraphrasing or detection

### 3. What API Integrations Exist?

**Correct Understanding:**
- **Zero additional API integrations** beyond user's Claude Code subscription
- User already pays for Claude Code → I (Claude) provide AI capabilities
- Python dependencies are local models (spaCy, GPT-2, BERT)

**NOT:**
- Separate Anthropic API calls with additional costs
- External detection services (Originality.ai, GPTZero)
- Translation services (DeepL, Google Translate)

### 4. What About Costs?

**Correct Understanding:**
- Token usage happens as part of Claude agent's processing
- Covered by user's existing Claude Code subscription
- System tracks token usage for transparency (200K-350K input, 100K-180K output per paper)

**NOT:**
- $2-4 per paper in additional API costs
- Separate charges for Claude API usage
- Pay-per-request model

---

## Impact on Implementation

### For Epic 7 (Orchestrator Implementation)

**What Changes:**
- The "orchestrator" is NOT a Python script
- The "orchestrator" is a **set of prompts/instructions for Claude agent**
- Epic 7 becomes: "Define Claude agent prompts and workflow logic"

**What Stays the Same:**
- Python tools still implemented as before (stdin/stdout JSON)
- Workflow coordination logic (7-step pipeline, iterations, decisions)
- Checkpoint-resume, error handling, state management

### For Developer Onboarding

**Developers Now Understand:**
1. Claude agent (running in Claude Code) orchestrates everything
2. Claude performs AI tasks directly (paraphrasing, detection)
3. Python tools are computational helpers only
4. No need to manage API keys, rate limits, or separate API costs
5. User needs active Claude Code subscription

---

## Validation

**PRD ↔ Architecture Alignment:** ✅ Now fully aligned

| Aspect | PRD v1.1 | Architecture v1.0 | Status |
|--------|----------|-------------------|--------|
| Orchestrator type | Claude agent with direct inference | Claude agent with direct inference | ✅ Aligned |
| API integrations | No additional APIs (Claude Code subscription) | No additional APIs | ✅ Aligned |
| Success rate | 90-95% | 90-95% | ✅ Aligned |
| Cost model | Token usage in subscription | Token usage in subscription | ✅ Aligned |
| Python tool role | Computational workers | Computational workers | ✅ Aligned |

---

## Related Documents

- **PRD v1.1:** `docs/prd.md` (updated)
- **Architecture v1.0:** `docs/architecture.md` (updated)
- **Gate Check Report:** See Winston's validation report (October 30, 2025)

---

**Document Status:** ✅ Complete
**Next Steps:** Proceed with Epic 1 (Development Environment Setup) using corrected architecture
